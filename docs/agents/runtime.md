# Runtime Runbook

Quick local debugging of the RAG pipeline without starting API/UI.

```bash
python -m src.agents.runtime --query "What are FY2025 productivity measures?"
```

## Useful Commands

Demo query catalog: `scripts/demo_queries.md`. Run any query with:

```bash
python -m src.agents.runtime --query "<paste query from scripts/demo_queries.md>"
```

Run with overrides (example):

```bash
python -m src.agents.runtime \
  --query "What are FY2025 productivity measures?" \
  --top-k 30 \
  --top-n 8
```

## Required Environment

- `OPENAI_API_KEY`
- `MILVUS_URI`
- `MILVUS_TOKEN`
- BM25 artifact at `artifacts/bm25_model.pkl` (generated by ingestion)

Optional overrides (defaults in `src/agents/core/config.py`): all `AGENT_*` knobs, plus `LANGCHAIN_*` for tracing.

## Tuning Model

- Operational knobs are env-backed in `src/agents/core/config.py`.
- Confidence-band cutoffs are not user-facing API inputs.
- Synthesis/reflection model + temperature are dev/ops knobs, not user API inputs.

## Runtime Output

The CLI prints confidence, state history, final reason, and the answer.

Notes:
- Planner may mark a query as incoherent; manager returns immediate polite rejection.
- For coherent queries, manager runs a single deterministic pass (`synthesize+reflect`).
- Answer text comes from synthesis; applicability/uncertainty come from reflection.
- Recency boosts are soft (see `docs/agents/scoring.md`).

## Failure Modes (high level)

- Startup readiness failure returns exit code `2` with `startup_error=MCP readiness failed: ...`.
- Guardrail terminal path returns a safe reply.
- Missing BM25 artifact or cross-encoder load failure blocks hybrid retrieval/rerank (strict mode fails at startup).
